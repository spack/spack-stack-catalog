spack:

  view: false

  concretizer:
    unify: false
    reuse: false

  compilers:
  - compiler:
      spec: oneapi@2022.2.0
      paths:
        cc: /soft/restricted/CNDA/sdk/2022.10.15.001/oneapi/compiler/2022.2.0/linux/bin/icx
        cxx: /soft/restricted/CNDA/sdk/2022.10.15.001/oneapi/compiler/2022.2.0/linux/bin/icpx
        f77: /soft/restricted/CNDA/sdk/2022.10.15.001/oneapi/compiler/2022.2.0/linux/bin/ifx
        fc: /soft/restricted/CNDA/sdk/2022.10.15.001/oneapi/compiler/2022.2.0/linux/bin/ifx
      flags: {}
      operating_system: opensuse_leap15
      target: x86_64
      modules:
      - oneapi/release/2022.10.15.001
      - spack/linux-opensuse_leap15-x86_64
      - libnl/3.3.0-gcc-10.2.0-h7m7thf
      - rdma-core/36.3-gcc-10.2.0-l2rnrjy
      - libfabric/1.14.0-gcc-10.2.0-hp2bsva
      - libpciaccess/0.16-gcc-10.2.0-kluhisj
      - hwloc/master-gcc-10.2.0-fbu4tbk
      - mpi/aurora_mpich/icc-sockets/49.1
      - gcc/10.2.0-gcc-10.2.0-yudlyez
      - .igc/release/20220901.1
      - intel_gpu_env/implicit_scaling
      - intel_gpu_env/multi_gpu
      - intel_gpu_env/platform_default
      - intel_compute_runtime/release/agama-devel-449
      environment:
        prepend_path:
          LD_LIBRARY_PATH: /soft/restricted/CNDA/sdk/2022.01.30.001/oneapi/compiler/20220503/linux/compiler/lib/intel64_lin:/soft/packaging/spack-builds/linux-opensuse_leap15-x86_64/gcc-10.2.0/libfabric-1.14.0-hp2bsvalxnpwh364mev25uz7ctjnyg6r/lib
      extra_rpaths:
      - /soft/packaging/spack-builds/linux-opensuse_leap15-x86_64/gcc-10.2.0/libfabric-1.14.0-hp2bsvalxnpwh364mev25uz7ctjnyg6r/lib
  - compiler:
      spec: gcc@10.2.0
      paths:
        cc: /soft/packaging/spack-builds/linux-opensuse_leap15-x86_64/gcc-10.2.0/gcc-10.2.0-yudlyezca7twgd5o3wkkraur7wdbngdn/bin/gcc
        cxx: /soft/packaging/spack-builds/linux-opensuse_leap15-x86_64/gcc-10.2.0/gcc-10.2.0-yudlyezca7twgd5o3wkkraur7wdbngdn/bin/g++
        f77: /soft/packaging/spack-builds/linux-opensuse_leap15-x86_64/gcc-10.2.0/gcc-10.2.0-yudlyezca7twgd5o3wkkraur7wdbngdn/bin/gfortran
        fc: /soft/packaging/spack-builds/linux-opensuse_leap15-x86_64/gcc-10.2.0/gcc-10.2.0-yudlyezca7twgd5o3wkkraur7wdbngdn/bin/gfortran
      flags: {}
      operating_system: opensuse_leap15
      target: x86_64
      modules:
      - spack/linux-opensuse_leap15-x86_64
      - gcc/10.2.0-gcc-10.2.0-yudlyez
      environment: {}
      extra_rpaths: []

  modules:
    default:
      enable:: [tcl]
      tcl:
        blacklist_implicits: true
        hash_length: 0
        naming_scheme: '{name}/{version}-{compiler.name}-{compiler.version}'
        all:
          autoload: direct
          conflict: ['{name}']
          environment:
            set:
              ${PACKAGE}_ROOT: ${PREFIX}
            unset: []
          load: []
          suffixes:
            ^mpich: mpi
            +sycl: sycl
            +level_zero: level-zero
            ^kokkos+sycl: sycl
        verbose: false

  packages:
    all:
      compiler: [oneapi]
      providers:
        blas: [openblas]
        mpi: [mpich]
      target: [icelake]
      variants: +mpi
    binutils:
      variants: +ld +gold +headers +libiberty ~nls
    elfutils:
      variants: +bzip2 ~nls +xz
    hdf5:
      variants: +fortran +hl +shared
    libunwind:
      variants: +pic +xz
    ncurses:
      variants: +termlib
    openblas:
      variants: threads=openmp
    python:
      version: [3.8.13]
    trilinos:
      variants: +amesos +amesos2 +anasazi +aztec +belos +boost +epetra +epetraext
        +ifpack +ifpack2 +intrepid +intrepid2 +isorropia +kokkos +ml +minitensor +muelu
        +nox +piro +phalanx +rol +rythmos +sacado +stk +shards +shylu +stokhos +stratimikos
        +teko +tempus +tpetra +trilinoscouplings +zoltan +zoltan2 +superlu-dist gotype=long_long
    xz:
      variants: +pic
    mesa:
      version: [21.3.8]

    # EXTERNALS
    libfabric:
      buildable: false
      externals:
      - spec: libfabric@1.14.0 fabrics=psm3,rxm,shm,sockets,tcp,udp,verbs ~kdreg ~debug
        prefix: /soft/packaging/spack-builds/linux-opensuse_leap15-x86_64/gcc-10.2.0/libfabric-1.14.0-hp2bsvalxnpwh364mev25uz7ctjnyg6r
        modules:
        - spack/linux-opensuse_leap15-x86_64
        - libfabric/1.14.0-gcc-10.2.0-hp2bsva
    mpich:
      buildable: false
      externals:
      - spec: mpich@4.0a2~hydra device=ch4
        prefix: /soft/restricted/CNDA/mpich/drop49.1/mpich-ofi-sockets-icc-default-gpu-drop49/
        modules:
        - oneapi/release/2022.10.15.001
        - mpi/aurora_mpich/icc-sockets/49.1
        - spack/linux-opensuse_leap15-x86_64
        - libfabric/1.14.0-gcc-10.2.0-hp2bsva

  specs:
  # CPU
  - amrex
  - arborx
  - butterflypack
  - chai ~benchmarks ~tests
  - conduit
  - darshan-runtime
  - darshan-util
  - faodel
  - hdf5 +fortran +hl +shared
  - hdf5-vol-async
  - heffte +fftw
  - hypre
  - kokkos +openmp
  - kokkos-kernels +openmp
  - mercury
  - metall
  - mfem
  - nccmp
  - nco
  - parallel-netcdf
  - petsc
  - strumpack ~slate
  - sundials
  - superlu
  - superlu-dist
  - tau +mpi +python ~pdt %oneapi ^binutils%gcc ^papi%gcc
  - trilinos +amesos +amesos2 +anasazi +aztec +belos +boost +epetra +epetraext
    +ifpack +ifpack2 +intrepid +intrepid2 +isorropia +kokkos +ml +minitensor +muelu
    +nox +piro +phalanx +rol +rythmos +sacado +stk +shards +shylu +stokhos +stratimikos
    +teko +tempus +tpetra +trilinoscouplings +zoltan +zoltan2 +superlu-dist gotype=long_long
  - umpire
  - vtk-m ~openmp # can't build +openmp w/ %oneapi: https://github.com/spack/spack/issues/31830

  # GPU
  - aml +ze
  - amrex +sycl
  - cabana +sycl ^kokkos +sycl +openmp std=17 +tests +examples
  - kokkos +sycl +openmp std=17 +tests +examples
  - kokkos-kernels build_type=Release ^kokkos +sycl +openmp std=17 +tests +examples
  - tau +mpi +opencl +level_zero ~pdt %oneapi ^binutils%gcc ^papi%gcc