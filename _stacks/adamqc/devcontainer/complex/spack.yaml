spack:
  specs:
  - cmake
  - dealii@master+mpi+petsc+p4est+python+trilinos~hdf5~gmsh~sundials~oce~cgal~assimp~symengine~examples
  - eigen
  - python
  - mumps+mpi+metis+parmetis
  - petsc+mumps+superlu-dist+complex~hdf5
  - tetgen
  - nanoflann

  packages:
    all:
      target:
      - x86_64

  container:
    images:
      os: "ubuntu:22.04"
      spack: develop

    format: docker

    strip: true

    os_packages:
      final:
      - build-essential
      - clangd
      - clang-format
      - gfortran
      - git
      - valgrind
      - vim

    extra_instructions:
      final: |
        RUN /opt/view/bin/python -m ensurepip && /opt/view/bin/python -m pip install autopep8 scipy numpy scipy matplotlib pandas -i https://pypi.org/simple && rm -rf /root/.cache && sed -i 's/ -lopen-pal//g' /opt/view/lib/cmake/deal.II/deal.IIConfig.cmake
        ENV OMPI_ALLOW_RUN_AS_ROOT=1 OMPI_ALLOW_RUN_AS_ROOT_CONFIRM=1
        RUN echo "source /etc/profile" >> /root/.bashrc
        USER root
        WORKDIR /root
