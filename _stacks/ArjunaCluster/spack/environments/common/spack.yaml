# This is a Spack Environment file.
#
# It describes a set of packages to be installed, along with
# configuration settings.
spack:
  config:
    concretizer: clingo
    install_missing_compilers: true
  packages:
    openssh:
      externals:
      - spec: openssh@7.4p1
        prefix: /usr
      buildable: false
    python:
      variants: ~pythoncmd
    cmake:
      version: [3.17.5]
      externals:
      - spec: cmake@3.17.5
        prefix: /usr/local
      buildable: false
    all:
      providers:
        blas: [openblas]
        mpi: [openmpi]
  definitions:
  - compiler:
    - gcc@11.2.0
  - cuda:
    - cuda
    - cuda@10.2:10.3
  - blas:
    - openblas
    - intel-mkl
    - netlib-lapack
  - mpi:
    - 'openmpi@4.1: fabrics=auto'
    - nvhpc+blas+lapack+mpi
    - mpich
  - python: ['python@3.9:']
  - pypkgs:
    - py-clustershell
    - py-pip
    - py-numpy
    - py-scipy
  - misc:
    - git
    - gmake
    - lmod
    - julia
    - miniconda3
    - libxc

  specs:
  - matrix:
    - [$compiler]
    - ['%gcc@4.8.5']
  - matrix:
    - [netlib-scalapack, fftw]
    - ['^openmpi@4.1: fabrics=auto']
    - [$%compiler]
  - matrix:
    - [$cuda, $blas, $mpi, $python, $misc]
    - [$%compiler]
  - matrix:
    - [$pypkgs]
    - [$^python]
    - [$%compiler]
  view: false
  modules:
    'enable:':
    - lmod
    - tcl
    default:
      lmod:
        core_compilers:
        - gcc@4.8.5
        hierarchy:
        - compiler
        - mpi
        blacklist_implicits: true
        hash_length: 0
    lmod:
      all:
        environment:
          set:
            '{name}_ROOT': '{prefix}'
      projections:
        all: '{name}/{version}'
        ^lapack: '{name}/{version}-{^lapack.name}'
